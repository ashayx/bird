var __reflect=this&&this.__reflect||function(t,e,i){t.__class__=e,i?i.push(e):i=[e],t.__types__=t.__types__?i.concat(t.__types__):i},__extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),Bird=function(t){function e(){var e=t.call(this)||this;return e.scaleNum=3,e.birdWidth=35*e.scaleNum,e.init(),e.x=.5*SWIDTH-e.birdWidth/2,e.y=.4*SHEIGHT,e.isAlive=!0,e.jumpHeight=80,e.g=.5,e.rotation=0,e}return __extends(e,t),e.prototype.init=function(){var t=RES.getRes("bird_json"),e=RES.getRes("bird_png"),i=new egret.MovieClipDataFactory(t,e),r=new egret.MovieClip(i.generateMovieClipData("bird"));r.anchorOffsetX+=r.width/2,r.anchorOffsetY+=r.height/2,r.x+=r.width/2,r.y+=r.height/2,r.rotation=this.rotation,r.scaleX=this.scaleNum,r.scaleY=this.scaleNum,r.gotoAndPlay(0,-1),this.addChild(r)},e.prototype.fallDown=function(){this.y+=this.g,this.g+=.5,this.rotation+=5,this.rotation>=90&&(this.rotation=90),this.y>=SHEIGHT-75-136&&(this.y=SHEIGHT-75-136,this.die())},e.prototype.jump=function(){this.y-=this.jumpHeight,this.g=0,this.rotation=-60,this.y<=0&&(this.y=0)},e.prototype.die=function(){this.isAlive=!1},e}(egret.Sprite);__reflect(Bird.prototype,"Bird");var Collide=function(){function t(){}return t}();__reflect(Collide.prototype,"Collide");var SceneEnd=function(t){function e(e){var i=t.call(this)||this;return i.score=e,i.addEventListener(egret.Event.ADDED_TO_STAGE,i.createSceneTitle,i),i}return __extends(e,t),e.prototype.createSceneTitle=function(){var t=this;this.addEventListener(egret.Event.ENTER_FRAME,function(){},this),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()};var e=this.createBitmapByName("bg");this.addChild(e),e.width=SWIDTH,e.height=SHEIGHT;var i=this.createBitmapByName("text_game_over_png");this.addChild(i),i.x=.2*SWIDTH,i.y=.15*SHEIGHT,i.width=.6*SWIDTH,i.height=.6*SWIDTH*.265,this.textField=new egret.BitmapText;var r=RES.getRes("font_fnt");this.textField.font=r,this.addChild(this.textField),this.textField.x=.48*SWIDTH,this.textField.y=.4*SHEIGHT,this.textField.scaleX=2.5,this.textField.scaleY=2.5,this.textField.text=""+this.score,this.textField.letterSpacing=2,this.textField.textAlign="center",this.addChild(this.textField);var n=this.createBitmapByName("button_ok_png");this.addChild(n),n.x=.4*SWIDTH,n.y=.6*SHEIGHT,n.width=.2*SWIDTH,n.height=.2*SWIDTH*.35,n.touchEnabled=!0,n.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.stage.addChild(new SceneTitle),t.stage.removeChild(t),console.log("重新开始")},this);var o=this.createBitmapByName("ground_png");this.addChild(o),o.x=0,o.y=SHEIGHT-136,o.width=2*SWIDTH,o.height=136},e.prototype.createBitmapByName=function(t){var e=new egret.Bitmap,i=RES.getRes(t);return e.texture=i,e},e}(egret.Sprite);__reflect(SceneEnd.prototype,"SceneEnd");var Game=function(t){function e(){var e=t.call(this)||this;return e.distance=.8*SWIDTH,e.addEventListener(egret.Event.ADDED_TO_STAGE,e.init,e),e}return __extends(e,t),e.prototype.init=function(){var t=this;this.score=0;var e=this.createBitmapByName("bg");this.addChild(e),e.width=SWIDTH,e.height=SHEIGHT,this.pipe=[];for(var i=0;3>i;i++){var r=new Pipe;r.x=this.distance*i+SWIDTH,this.pipe.push(r),this.addChild(r)}this.ground=new Ground,this.addChild(this.ground),this.bird=new Bird,this.addChild(this.bird),this.calculatedScore(),egret.Ticker.getInstance().register(this.runGame,this),e.touchEnabled=!0,e.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.bird.isAlive&&t.bird.jump()},this)},e.prototype.runGame=function(t){if(this.bird.isAlive){this.bird.fallDown(),this.ground.move();var e=this.bird.x,i=this.bird.y,r=this.bird.birdWidth;for(var n in this.pipe){var o=this.pipe[n];o.move(),o.x<this.bird.x&&!o.isAddScore&&(this.score++,this.textField.text=""+this.score,o.isAddScore=!0),e+r/2>o.x&&e<o.x+o.pipeWidth&&(i<o.y+o.pipeHeight||i+50>o.y+o.pipeHeight+o.space)&&(this.bird.isAlive=!1,console.log("碰撞"))}}else this.stage.addChild(new SceneEnd(this.score)),this.stage.removeChild(this),egret.Ticker.getInstance().unregister(this.runGame,this),console.log(this.bird.isAlive,"die")},e.prototype.calculatedScore=function(){this.textField=new egret.BitmapText;var t=RES.getRes("font_fnt");this.textField.font=t,this.addChild(this.textField),this.textField.x=.48*SWIDTH,this.textField.y=.15*SHEIGHT,this.textField.scaleX=2.5,this.textField.scaleY=2.5,this.textField.text=""+this.score,this.textField.letterSpacing=2,this.textField.textAlign="center",this.addChild(this.textField)},e.prototype.createBitmapByName=function(t){var e=new egret.Bitmap,i=RES.getRes(t);return e.texture=i,e},e}(egret.Sprite);__reflect(Game.prototype,"Game");var Ground=function(t){function e(){var e=t.call(this)||this;return e.x=0,e.init(),e}return __extends(e,t),e.prototype.init=function(){var t=new egret.Bitmap;t.texture=RES.getRes("ground_png"),this.addChild(t),t.x=0,t.y=SHEIGHT-136,t.width=2*SWIDTH,t.height=136},e.prototype.move=function(){this.x-=5,this.x===-SWIDTH&&(this.x=0)},e}(egret.Sprite);__reflect(Ground.prototype,"Ground");var LoadingUI=function(t){function e(){var e=t.call(this)||this;return e.createView(),e}return __extends(e,t),e.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},e.prototype.setProgress=function(t,e){this.textField.text="Loading..."+t+"/"+e},e}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI");var Main=function(t){function e(){var e=t.call(this)||this;return e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e}return __extends(e,t),e.prototype.onAddToStage=function(t){SWIDTH=this.stage.stageWidth,SHEIGHT=this.stage.stageHeight,this.loadingView=new LoadingUI,this.stage.addChild(this.loadingView),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/default.res.json","resource/")},e.prototype.onConfigComplete=function(t){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),RES.loadGroup("preload")},e.prototype.onResourceLoadComplete=function(t){"preload"==t.groupName&&(this.stage.removeChild(this.loadingView),RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),this.createGameScene())},e.prototype.onItemLoadError=function(t){console.warn("Url:"+t.resItem.url+" has failed to load")},e.prototype.onResourceLoadError=function(t){console.warn("Group:"+t.groupName+" has failed to load"),this.onResourceLoadComplete(t)},e.prototype.onResourceProgress=function(t){"preload"==t.groupName&&this.loadingView.setProgress(t.itemsLoaded,t.itemsTotal)},e.prototype.createGameScene=function(){this.stage.addChild(new SceneTitle),this.stage.removeChild(this)},e}(egret.DisplayObjectContainer);__reflect(Main.prototype,"Main");var Pipe=function(t){function e(){var e=t.call(this)||this;return e.isAddScore=!1,e.space=.25*SHEIGHT,e.x=.6*SWIDTH,e.y=-e.randomBetwen(.1*SHEIGHT,.5*SHEIGHT),e.pipeWidth=.2*SWIDTH,e.pipeHeight=.7*SHEIGHT,e.pipeDistance=.6*SWIDTH,e.init(),e}return __extends(e,t),e.prototype.init=function(){this.pipeTop=new egret.Bitmap,this.pipeTop.texture=RES.getRes("tube_png"),this.pipeTop.x=0,this.pipeTop.y=0,this.pipeTop.width=this.pipeWidth,this.pipeTop.height=this.pipeHeight,this.addChild(this.pipeTop),this.pipeDown=new egret.Bitmap,this.pipeDown.texture=RES.getRes("tube_png"),this.pipeDown.x=0,this.pipeDown.y=this.pipeHeight+this.space,this.pipeDown.width=this.pipeWidth,this.pipeDown.height=this.pipeHeight,this.addChild(this.pipeDown)},e.prototype.move=function(){this.x-=5,this.x<=1.6*-SWIDTH&&(this.isAddScore=!1,this.y=-this.randomBetwen(.1*SHEIGHT,.6*SHEIGHT),this.x=1*SWIDTH)},e.prototype.randomBetwen=function(t,e){return Math.floor(Math.random()*(e-t)+t)},e}(egret.Sprite);__reflect(Pipe.prototype,"Pipe");var SceneTitle=function(t){function e(){var e=t.call(this)||this;return e.addEventListener(egret.Event.ADDED_TO_STAGE,e.createSceneTitle,e),e}return __extends(e,t),e.prototype.createSceneTitle=function(){var t=this,e=this.createBitmapByName("bg");this.addChild(e),e.width=SWIDTH,e.height=SHEIGHT;var i=this.createBitmapByName("title_png");this.addChild(i),i.width=.6*SWIDTH,i.height=.6*SWIDTH*.27,i.x=.2*SWIDTH,i.y=.15*SHEIGHT;var r=this.createBitmapByName("button_play_png");this.addChild(r),r.x=.4*SWIDTH,r.y=.6*SHEIGHT,r.width=.2*SWIDTH,r.height=.2*SWIDTH*.6;var n=new Bird;this.addChild(n);var o=new Ground;this.addChild(o),r.touchEnabled=!0,r.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){console.log("开始"),t.stage.addChild(new Game),t.stage.removeChild(t)},this)},e.prototype.createBitmapByName=function(t){var e=new egret.Bitmap,i=RES.getRes(t);return e.texture=i,e},e}(egret.Sprite);__reflect(SceneTitle.prototype,"SceneTitle");